---
import Info from "./Info.astro";
---

<section class="hero">
  <div class="hero-bg"></div>
  <p class="title">
    <span class="word-container"></span>
  </p>
  <Info />
</section>

<style>
  .hero {
    position: relative;
    width: 100%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    z-index: 1;
  }

  .hero.hovering-images .title {
    color: #ffffff;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
  }

  .hero.hovering-images :global(.info p) {
    color: #ffffff;
  }

  .hero-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    opacity: 0;
    transition: opacity 0.5s ease;
    z-index: 0;
  }

  .hero-bg.active {
    opacity: 1;
  }

  .title {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    text-align: center;
    font-family: "Monument Extended", sans-serif;
    font-size: 7vw;
    font-weight: 800;
    text-transform: uppercase;
    color: #15152a;
    overflow: hidden;
    opacity: 0;
    z-index: 1;
    padding: 0 5vw;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  }

  .word-container {
    display: inline-block;
    white-space: nowrap;
  }

  :global(.word-container .letter) {
    display: inline-block;
    line-height: 1em;
  }

  /* Mobile responsiveness */
  @media (max-width: 768px) {
    .title {
      font-size: 6.5vw;
      padding: 0 1vw;
    }
  }

  /* Small mobile devices */
  @media (max-width: 480px) {
    .title {
      font-size: 5.5vw;
      padding: 0 0.5vw;
    }
  }

  /* Aspect ratio adjustments */
  @media (min-aspect-ratio: 16/10) {
    .title {
      font-size: 6.5vw;
    }
  }

  @media (min-aspect-ratio: 16/9) {
    .title {
      font-size: 7vw;
    }
  }
</style>

<script>
  import { gsap } from "gsap";

  const words = [
    "Quiero invertir en",
    "seguridad",
    "confianza",
    "alta rentabilidad",
    "crecimiento",
    "locales",
    "marcas",
    "mi comunidad",
    "futuro",
    "patrimonio",
  ];

  const wordContainer = document.querySelector(".word-container");
  const titleElement = document.querySelector(".title");

  if (!wordContainer || !titleElement) {
    throw new Error("Required elements not found");
  }

  const container = wordContainer as HTMLSpanElement;
  const title = titleElement as HTMLParagraphElement;
  let currentWordIndex = 0;

  function wrapLetters(text: string): string {
    return text.replace(/\S/g, "<span class='letter'>$&</span>");
  }

  function animateWord(
    word: string,
    isFirstPhrase: boolean,
  ): gsap.core.Timeline {
    const tl = gsap.timeline();

    // Set the word with wrapped letters
    container.innerHTML = wrapLetters(word);

    const letters = container.querySelectorAll(".letter");

    // Animate letters in
    tl.fromTo(
      letters,
      {
        y: -200,
        opacity: 0,
      },
      {
        y: 0,
        opacity: 1,
        duration: isFirstPhrase ? 1.2 : 0.8,
        ease: "expo.out",
        stagger: isFirstPhrase ? 0.08 : 0.05,
      },
    );

    // Hold the word visible
    tl.to({}, { duration: isFirstPhrase ? 2.5 : 1.5 });

    // Animate letters out
    tl.to(letters, {
      y: 200,
      opacity: 0,
      duration: 0.5,
      ease: "expo.in",
      stagger: 0.02,
    });

    return tl;
  }

  function cycleWords() {
    const word = words[currentWordIndex];
    const isFirstPhrase = word.startsWith("Quiero invertir");

    const tl = animateWord(word, isFirstPhrase);

    tl.eventCallback("onComplete", () => {
      currentWordIndex = (currentWordIndex + 1) % words.length;
      cycleWords();
    });
  }

  // Wait for preloader to complete before starting word animation
  window.addEventListener("preloaderComplete", () => {
    // Make title visible
    gsap.to(title, {
      opacity: 1,
      duration: 0.01,
      onComplete: () => {
        cycleWords();
      },
    });
  });

  // Handle preview image hover to change hero background
  const heroBg = document.querySelector(".hero-bg") as HTMLDivElement | null;
  const prevImages = document.querySelectorAll(".prev-img");
  const imageUrls = [
    "/images/prev-1.webp",
    "/images/prev-2.webp",
    "/images/prev-3.webp",
  ];

  const heroSection = document.querySelector(".hero") as HTMLDivElement | null;

  if (heroBg && heroSection) {
    const heroLogo = document.querySelector(
      ".hero-img img",
    ) as HTMLImageElement | null;

    prevImages.forEach((prevImg, index) => {
      prevImg.addEventListener("mouseenter", () => {
        heroBg.style.backgroundImage = `url("${imageUrls[index]}")`;
        heroBg.classList.add("active");
        heroSection.classList.add("hovering-images");
        if (heroLogo) {
          heroLogo.src = "/logo-full-blanco.webp";
        }
      });

      prevImg.addEventListener("mouseleave", () => {
        heroBg.classList.remove("active");
        heroSection.classList.remove("hovering-images");
        if (heroLogo) {
          heroLogo.src = "/logo-full.webp";
        }
      });
    });
  }
</script>
